{% doc %}
  @prompt
    Create a custom header enhancement block that increases the header height and adds a smooth scale-down animation to the logo when the page is scrolled. The logo should be full size when at the top of the page, then smoothly scale down to a smaller size as the user scrolls down. Include smooth CSS transitions for a polished effect.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-header-enhancement-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 9999;
    pointer-events: none;
  }

  .ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper {
    position: absolute;
    top: {{ block.settings.logo_top_position }}px;
    left: {{ block.settings.logo_left_position }}px;
    transform-origin: top left;
    transition: transform {{ block.settings.transition_duration }}s ease;
    pointer-events: auto;
  }

  .ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper img {
    display: block;
    height: {{ block.settings.logo_full_height }}px;
    width: auto;
  }

  .ai-header-enhancement-{{ ai_gen_id }}--scrolled .ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper {
    transform: scale({{ block.settings.logo_scale_factor }});
  }

  .ai-header-enhancement-{{ ai_gen_id }}__spacer {
    height: {{ block.settings.header_height }}px;
    transition: height {{ block.settings.transition_duration }}s ease;
  }

  .ai-header-enhancement-{{ ai_gen_id }}--scrolled .ai-header-enhancement-{{ ai_gen_id }}__spacer {
    height: {{ block.settings.header_height_scrolled }}px;
  }

  @media screen and (max-width: 749px) {
    .ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper {
      top: {{ block.settings.logo_top_position_mobile }}px;
      left: {{ block.settings.logo_left_position_mobile }}px;
    }

    .ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper img {
      height: {{ block.settings.logo_full_height_mobile }}px;
    }

    .ai-header-enhancement-{{ ai_gen_id }}__spacer {
      height: {{ block.settings.header_height_mobile }}px;
    }

    .ai-header-enhancement-{{ ai_gen_id }}--scrolled .ai-header-enhancement-{{ ai_gen_id }}__spacer {
      height: {{ block.settings.header_height_scrolled_mobile }}px;
    }
  }
{% endstyle %}

<header-enhancement-{{ ai_gen_id }} class="ai-header-enhancement-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-header-enhancement-{{ ai_gen_id }}__spacer"></div>
  
  {% if block.settings.logo != blank %}
    <div class="ai-header-enhancement-{{ ai_gen_id }}__logo-wrapper">
      <a href="/">
        <img
          src="{{ block.settings.logo | image_url: width: 600 }}"
          alt="{{ shop.name }}"
          width="{{ block.settings.logo.width }}"
          height="{{ block.settings.logo.height }}"
          loading="eager"
        >
      </a>
    </div>
  {% endif %}
</header-enhancement-{{ ai_gen_id }}>

<script>
  (function() {
    class HeaderEnhancement{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.scrollThreshold = {{ block.settings.scroll_threshold }};
        this.isScrolled = false;
      }

      connectedCallback() {
        this.handleScroll = this.handleScroll.bind(this);
        window.addEventListener('scroll', this.handleScroll, { passive: true });
        this.handleScroll();
      }

      disconnectedCallback() {
        window.removeEventListener('scroll', this.handleScroll);
      }

      handleScroll() {
        const scrollY = window.scrollY || window.pageYOffset;
        const shouldBeScrolled = scrollY > this.scrollThreshold;

        if (shouldBeScrolled !== this.isScrolled) {
          this.isScrolled = shouldBeScrolled;
          this.classList.toggle('ai-header-enhancement-{{ ai_gen_id }}--scrolled', this.isScrolled);
        }
      }
    }

    customElements.define('header-enhancement-{{ ai_gen_id }}', HeaderEnhancement{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Header enhancement",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_full_height",
      "min": 20,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Desktop full height",
      "default": 80
    },
    {
      "type": "range",
      "id": "logo_full_height_mobile",
      "min": 20,
      "max": 120,
      "step": 5,
      "unit": "px",
      "label": "Mobile full height",
      "default": 60
    },
    {
      "type": "range",
      "id": "logo_scale_factor",
      "min": 0.3,
      "max": 1,
      "step": 0.1,
      "label": "Scale when scrolled",
      "default": 0.6
    },
    {
      "type": "range",
      "id": "logo_top_position",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Desktop top position",
      "default": 20
    },
    {
      "type": "range",
      "id": "logo_left_position",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Desktop left position",
      "default": 40
    },
    {
      "type": "range",
      "id": "logo_top_position_mobile",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Mobile top position",
      "default": 15
    },
    {
      "type": "range",
      "id": "logo_left_position_mobile",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Mobile left position",
      "default": 20
    },
    {
      "type": "header",
      "content": "Header spacing"
    },
    {
      "type": "range",
      "id": "header_height",
      "min": 60,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Desktop height at top",
      "default": 120
    },
    {
      "type": "range",
      "id": "header_height_scrolled",
      "min": 40,
      "max": 150,
      "step": 5,
      "unit": "px",
      "label": "Desktop height when scrolled",
      "default": 70
    },
    {
      "type": "range",
      "id": "header_height_mobile",
      "min": 50,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Mobile height at top",
      "default": 90
    },
    {
      "type": "range",
      "id": "header_height_scrolled_mobile",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Mobile height when scrolled",
      "default": 60
    },
    {
      "type": "header",
      "content": "Scroll behavior"
    },
    {
      "type": "range",
      "id": "scroll_threshold",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Scroll distance to trigger",
      "default": 50
    },
    {
      "type": "range",
      "id": "transition_duration",
      "min": 0.1,
      "max": 1,
      "step": 0.1,
      "unit": "s",
      "label": "Transition duration",
      "default": 0.3
    }
  ],
  "presets": [
    {
      "name": "Header enhancement"
    }
  ]
}
{% endschema %}
